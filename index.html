<!DOCTYPE html>
<html>

    <a id="download">Download</a>
    <button id="stop">Stop</button>
    <button id="start">Capture</button>
    <textarea id="apikey"></textarea>
    <script>
      let stopped = true;
      const downloadLink = document.getElementById('download');
      const stopButton = document.getElementById('stop');
      const startButton = document.getElementById('start');
      const recordedChunks = [];

      function GetBlob(){
        return new Blob(recordedChunks);
      }
    
      const handleSuccess = function(stream) {
        const options = {mimeType: 'audio/webm'};
        const mediaRecorder = new MediaRecorder(stream, options);
    
        startButton.onclick = function() {

         

          if(stopped === true){
            mediaRecorder.start();
            stopped = false;
          }
        }

        stopButton.addEventListener('click', function() {
          stopped = true;
          mediaRecorder.requestData();
          mediaRecorder.stop();
          console.log("recorder stopped, data available");
        });

        mediaRecorder.ondataavailable = function(e) {
          if (e.data.size > 0) {
            recordedChunks.push(e.data);
          }
        };
    
        mediaRecorder.addEventListener('stop', function() {
          downloadLink.href = URL.createObjectURL(new Blob(recordedChunks));
          downloadLink.download = 'acetest.wav';
        });
    
      };
      
      navigator.mediaDevices.enumerateDevices().then((devices) => {
            devices.forEach(element => {
              console.log(element.deviceId);
            });
      });

      navigator.mediaDevices.getUserMedia({ audio: true, video: false })
          .then(handleSuccess);

    </script>
    
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>wasm</title>
    <base href="https://d-abreu.github.io/TicTacToe/" />
    <link href="css/bootstrap/bootstrap.min.css" rel="stylesheet" />
    <link href="css/app.css" rel="stylesheet" />
</head>

<body>
    <app>Loading...</app>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ðŸ—™</a>
    </div>
    <script src="_framework/blazor.webassembly.js"></script>
</body>

</html>
